<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robodog Integrations Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        h2 {
            color: #569cd6;
            margin-top: 30px;
        }
        .section {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #1177bb;
        }
        button:active {
            background: #0d5a8f;
        }
        .success {
            background: #0e7c0e;
        }
        .success:hover {
            background: #13a10e;
        }
        .warning {
            background: #ca5010;
        }
        .warning:hover {
            background: #e05515;
        }
        input, textarea {
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            color: #d4d4d4;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        .output {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.connected {
            background: #0e7c0e;
            border: 1px solid #13a10e;
        }
        .status.disconnected {
            background: #a80000;
            border: 1px solid #c50000;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>ü§ñ Robodog Integrations Test UI</h1>
    
    <div class="section">
        <h2>üîå MCP Server Connection</h2>
        <div id="connectionStatus" class="status disconnected">Disconnected</div>
        <button onclick="testConnection()">Test Connection</button>
        <button onclick="getHelp()">Get Available Commands</button>
        <div id="connectionOutput" class="output"></div>
    </div>

    <div class="grid">
        <div class="section">
            <h2>üìù Amplenote Integration</h2>
            
            <h3>List Notes</h3>
            <button onclick="amplenoteList()">List All Notes</button>
            <div id="amplenoteListOutput" class="output"></div>

            <h3>Create Note</h3>
            <input type="text" id="amplenoteNoteName" placeholder="Note name" value="Test Note from UI">
            <input type="text" id="amplenoteNoteTags" placeholder="Tags (comma-separated)" value="test,ui">
            <button class="success" onclick="amplenoteCreate()">Create Note</button>
            <div id="amplenoteCreateOutput" class="output"></div>

            <h3>Add Content to Note</h3>
            <input type="text" id="amplenoteNoteUuid" placeholder="Note UUID">
            <textarea id="amplenoteContent" rows="3" placeholder="Content to add">This is test content added from the UI!</textarea>
            <button class="success" onclick="amplenoteAdd()">Add Content</button>
            <div id="amplenoteAddOutput" class="output"></div>

            <h3>Add Task to Note</h3>
            <input type="text" id="amplenoteTaskUuid" placeholder="Note UUID">
            <input type="text" id="amplenoteTaskText" placeholder="Task text" value="Complete UI testing">
            <button class="success" onclick="amplenoteTask()">Add Task</button>
            <div id="amplenoteTaskOutput" class="output"></div>
        </div>

        <div class="section">
            <h2>‚úÖ Todoist Integration</h2>
            
            <h3>List Projects</h3>
            <button onclick="todoistProjects()">List All Projects</button>
            <div id="todoistProjectsOutput" class="output"></div>

            <h3>List Tasks</h3>
            <input type="text" id="todoistProjectId" placeholder="Project ID (optional)">
            <button onclick="todoistTasks()">List Tasks</button>
            <div id="todoistTasksOutput" class="output"></div>

            <h3>Create Task</h3>
            <input type="text" id="todoistTaskContent" placeholder="Task content" value="Test task from UI">
            <input type="text" id="todoistTaskDue" placeholder="Due date (e.g., tomorrow)" value="tomorrow">
            <select id="todoistTaskPriority">
                <option value="1">Priority 1 (Normal)</option>
                <option value="2">Priority 2 (Medium)</option>
                <option value="3" selected>Priority 3 (High)</option>
                <option value="4">Priority 4 (Urgent)</option>
            </select>
            <button class="success" onclick="todoistCreate()">Create Task</button>
            <div id="todoistCreateOutput" class="output"></div>

            <h3>Complete Task</h3>
            <input type="text" id="todoistCompleteId" placeholder="Task ID">
            <button class="warning" onclick="todoistComplete()">Complete Task</button>
            <div id="todoistCompleteOutput" class="output"></div>

            <h3>List Labels</h3>
            <button onclick="todoistLabels()">List All Labels</button>
            <div id="todoistLabelsOutput" class="output"></div>
        </div>
    </div>

    <script>
        const MCP_URL = 'http://127.0.0.1:2500';
        const MCP_TOKEN = 'testtoken';

        async function mcpCall(operation, payload = {}) {
            try {
                const response = await fetch(MCP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MCP_TOKEN}`
                    },
                    body: JSON.stringify({ operation, payload })
                });
                return await response.json();
            } catch (error) {
                return { status: 'error', error: error.message };
            }
        }

        function displayOutput(elementId, data) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
        }

        async function testConnection() {
            const result = await mcpCall('HELP');
            const statusEl = document.getElementById('connectionStatus');
            
            if (result.status === 'ok') {
                statusEl.textContent = '‚úÖ Connected to MCP Server';
                statusEl.className = 'status connected';
                displayOutput('connectionOutput', { 
                    status: 'Connected',
                    totalCommands: result.commands.length 
                });
            } else {
                statusEl.textContent = '‚ùå Disconnected - Start MCP server';
                statusEl.className = 'status disconnected';
                displayOutput('connectionOutput', result);
            }
        }

        async function getHelp() {
            const result = await mcpCall('HELP');
            displayOutput('connectionOutput', result);
        }

        // Amplenote functions
        async function amplenoteList() {
            const result = await mcpCall('AMPLENOTE_LIST');
            displayOutput('amplenoteListOutput', result);
        }

        async function amplenoteCreate() {
            const name = document.getElementById('amplenoteNoteName').value;
            const tagsStr = document.getElementById('amplenoteNoteTags').value;
            const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()) : [];
            
            const result = await mcpCall('AMPLENOTE_CREATE', { name, tags });
            displayOutput('amplenoteCreateOutput', result);
            
            if (result.status === 'ok' && result.note) {
                document.getElementById('amplenoteNoteUuid').value = result.note.uuid;
                document.getElementById('amplenoteTaskUuid').value = result.note.uuid;
            }
        }

        async function amplenoteAdd() {
            const note_uuid = document.getElementById('amplenoteNoteUuid').value;
            const content = document.getElementById('amplenoteContent').value;
            
            const result = await mcpCall('AMPLENOTE_ADD', { note_uuid, content });
            displayOutput('amplenoteAddOutput', result);
        }

        async function amplenoteTask() {
            const note_uuid = document.getElementById('amplenoteTaskUuid').value;
            const task_text = document.getElementById('amplenoteTaskText').value;
            
            const result = await mcpCall('AMPLENOTE_TASK', { note_uuid, task_text });
            displayOutput('amplenoteTaskOutput', result);
        }

        // Todoist functions
        async function todoistProjects() {
            const result = await mcpCall('TODOIST_PROJECTS');
            displayOutput('todoistProjectsOutput', result);
        }

        async function todoistTasks() {
            const project_id = document.getElementById('todoistProjectId').value || undefined;
            const result = await mcpCall('TODOIST_TASKS', { project_id });
            displayOutput('todoistTasksOutput', result);
        }

        async function todoistCreate() {
            const content = document.getElementById('todoistTaskContent').value;
            const due_string = document.getElementById('todoistTaskDue').value;
            const priority = parseInt(document.getElementById('todoistTaskPriority').value);
            
            const result = await mcpCall('TODOIST_CREATE', { content, due_string, priority });
            displayOutput('todoistCreateOutput', result);
            
            if (result.status === 'ok' && result.task) {
                document.getElementById('todoistCompleteId').value = result.task.id;
            }
        }

        async function todoistComplete() {
            const task_id = document.getElementById('todoistCompleteId').value;
            const result = await mcpCall('TODOIST_COMPLETE', { task_id });
            displayOutput('todoistCompleteOutput', result);
        }

        async function todoistLabels() {
            const result = await mcpCall('TODOIST_LABELS');
            displayOutput('todoistLabelsOutput', result);
        }

        // Test connection on load
        window.addEventListener('load', () => {
            testConnection();
        });
    </script>
</body>
</html>
